<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>{{ resume.profile.full_name }}'s Resume</title>
    <style type="text/css">
        @page {
            size: a4;
            margin: 1.5cm;
        }
        body {
            font-family: 'Helvetica', 'Arial', sans-serif;
            color: #333333;
            font-size: 10.5pt;
            line-height: 1.5;
        }
        .name {
            font-size: 26pt;
            font-weight: bold;
            text-align: center;
            margin: 0;
            padding: 0;
            color: #2c3e50;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        .contact-info {
            text-align: center;
            font-size: 9.5pt;
            color: #555555;
            margin-bottom: 20px;
            border-bottom: 1px solid #cccccc;
            padding-bottom: 10px;
        }
        .section-title {
            font-size: 14pt;
            font-weight: bold;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
            margin-top: 20px;
            margin-bottom: 15px;
            text-transform: uppercase;
            page-break-after: avoid; /* Prevents the title from being at the bottom of a page alone */
        }
        .section {
            margin-bottom: 15px;
            page-break-inside: avoid; /* Tries to keep the whole section together */
        }
        .item {
            margin-bottom: 15px;
            page-break-inside: avoid;
        }
        .item-header {
            overflow: auto; /* Clear floats */
            margin-bottom: 3px;
        }
        .title {
            font-weight: bold;
            font-size: 11.5pt;
        }
        .subtitle {
            font-style: italic;
            color: #444444;
        }
        .date {
            float: right;
            font-style: italic;
            font-size: 10pt;
            color: #555555;
        }
        .description {
            margin-top: 5px;
            white-space: pre-wrap; /* Preserves line breaks from the textarea */
            text-align: justify;
        }
        .tech-details {
            font-size: 9.5pt;
            color: #444;
            margin-top: 5px;
        }
        .skill-category {
            font-weight: bold;
            font-size: 11pt;
            margin-top: 10px;
        }
        ul {
            padding-left: 20px;
            margin-top: 5px;
        }
        .declaration {
            margin-top: 30px;
            padding-top: 15px;
            border-top: 1px solid #cccccc;
            font-size: 9.5pt;
            color: #555555;
            page-break-inside: avoid;
        }
        a {
            color: #3498db;
            text-decoration: none;
        }
    </style>
</head>
<body>

    <div class="name">{{ resume.profile.full_name|default:resume.profile.user.username }}</div>
    <div class="contact-info">
        {% if resume.profile.phone_number %}<a href="tel:{{ resume.profile.phone_number }}">{{ resume.profile.phone_number }}</a> | {% endif %}
        <a href="mailto:{{ resume.profile.user.email }}">{{ resume.profile.user.email }}</a> | 
        {{ resume.profile.address|default:'' }}
        {% if resume.profile.portfolio_url %}| <a href="{{ resume.profile.portfolio_url }}">Portfolio</a>{% endif %}
        {% if resume.profile.linkedin_url %}| <a href="{{ resume.profile.linkedin_url }}">LinkedIn</a>{% endif %}
    </div>

    {% if resume.profile.professional_summary %}
    <div class="section">
        <div class="section-title">Summary</div>
        <div class="description">{{ resume.profile.professional_summary|linebreaksbr }}</div>
    </div>
    {% endif %}

    {% if experiences %}
    <div class="section">
        <div class="section-title">Work Experience</div>
        {% for exp in experiences %}
            <div class="item">
                <div class="item-header">
                    <span class="date">{{ exp.start_date|date:"M Y" }} - {% if exp.end_date %}{{ exp.end_date|date:"M Y" }}{% else %}Present{% endif %}</span>
                    <p class="title">{{ exp.job_title }}</p>
                </div>
                <p class="subtitle">{{ exp.company }}</p>
                <div class="description">{{ exp.description|linebreaksbr }}</div>
            </div>
        {% endfor %}
    </div>
    {% endif %}
    
    {% if educations %}
    <div class="section">
        <div class="section-title">Education</div>
        {% for edu in educations %}
            <div class="item">
                <div class="item-header">
                    <span class="date">{{ edu.start_date|date:"M Y" }} - {% if edu.end_date %}{{ edu.end_date|date:"M Y" }}{% else %}Present{% endif %}</span>
                    <p class="title">{{ edu.degree }} in {{ edu.field_of_study }}</p>
                </div>
                <p class="subtitle">{{ edu.institution }}{% if edu.address %}, {{ edu.address }}{% endif %}</p>
                {% if edu.percentage %}<p style="margin-top: 2px; font-size: 10pt;"><strong>Grade/Percentage:</strong> {{ edu.percentage }}</p>{% endif %}
            </div>
        {% endfor %}
    </div>
    {% endif %}

    {% if projects %}
    <div class="section">
        <div class="section-title">Projects</div>
        {% for p in projects %}
            <div class="item">
                <p class="title">{{ p.title }}</p>
                {% if p.aim %}<p class="subtitle">{{ p.aim }}</p>{% endif %}
                <div class="description">{{ p.description|linebreaksbr }}</div>
                <div class="tech-details">
                    {% if p.frontend %}<strong>Frontend:</strong> {{ p.frontend }}<br>{% endif %}
                    {% if p.backend %}<strong>Backend:</strong> {{ p.backend }}<br>{% endif %}
                    {% if p.database %}<strong>Database:</strong> {{ p.database }}<br>{% endif %}
                    {% if p.link %}<strong>Link:</strong> <a href="{{ p.link }}">{{ p.link }}</a>{% endif %}
                </div>
            </div>
        {% endfor %}
    </div>
    {% endif %}

    {% if skills_by_category %}
    <div class="section">
        <div class="section-title">Skills</div>
        {% for category, skills in skills_by_category.items %}
            <p><strong class="skill-category">{{ category }}:</strong> {{ skills|join:", " }}</p>
        {% endfor %}
    </div>
    {% endif %}

    {% if certifications %}
    <div class="section">
        <div class="section-title">Certifications</div>
        <ul>
        {% for cert in certifications %}
            <li><strong>{{ cert.name }}</strong> - <em>{{ cert.issuing_organization }}</em> {% if cert.date_issued %}({{ cert.date_issued|date:"M Y" }}){% endif %}</li>
        {% endfor %}
        </ul>
    </div>
    {% endif %}

    {% if achievements %}
    <div class="section">
        <div class="section-title">Achievements</div>
        <ul>
        {% for a in achievements %}
            <li>{% if a.name %}<strong>{{ a.name }}:</strong> {% endif %}{{ a.description }}</li>
        {% endfor %}
        </ul>
    </div>
    {% endif %}

    {% if languages %}
    <div class="section">
        <div class="section-title">Languages</div>
        <p>{% for lang in languages %}{{ lang.name }} ({{ lang.get_proficiency_display }}){% if not forloop.last %}, {% endif %}{% endfor %}</p>
    </div>
    {% endif %}

    {% if hobbies %}
    <div class="section">
        <div class="section-title">Hobbies</div>
        <p>{{ hobbies|join:", " }}</p>
    </div>
    {% endif %}

    <div class="declaration">
        <p>I hereby declare that the information provided is true and correct to the best of my knowledge.</p>
        <p style="margin-top: 25px;">
            <strong>Date:</strong> {% now "F d, Y" %}
            <br><br>
            <strong>Signature:</strong>
            <br><br>
            _________________________
            <br>
            ({{ resume.profile.full_name }})
        </p>
    </div>

</body>
</html>
