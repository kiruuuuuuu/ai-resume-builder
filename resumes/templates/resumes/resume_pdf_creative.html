<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>{{ resume.profile.full_name }}'s Resume</title>
    <style type="text/css">
        @page {
            size: a4;
            margin: 0.5cm;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            color: #2d3748;
            font-size: 8.5pt; /* Base font size - will scale dynamically */
            line-height: 1.3; /* Comfortable line height */
            background-color: white;
            margin: 0;
            padding: 0;
        }
        /* Dynamic font sizing - adjust based on content */
        :root {
            --base-font-size: 8.5pt;
            --scale-factor: 1;
        }
        
        .resume-container {
            background: white;
            padding: 0;
            max-width: 100%;
            max-height: 286mm; /* Strict limit for single page */
            height: 286mm; /* Fixed height for single page */
            overflow: hidden;
            page-break-after: avoid; /* Prevent page break */
            page-break-inside: avoid; /* Prevent page break */
        }
        
        /* Header */
        .header {
            background: {{ accent_color|default:'#667eea' }};
            color: white;
            padding: 10px 15px; /* Further reduced padding */
            margin-bottom: 8px; /* Further reduced margin */
        }
        
        .name {
            font-size: 22pt; /* Reduced for better fit */
            font-weight: 800;
            color: white;
            margin: 0 0 4px 0; /* Reduced margin */
            word-wrap: break-word;
            line-height: 1.1;
        }
        
        .contact-info {
            font-size: 7pt; /* Further reduced */
            color: rgba(255, 255, 255, 0.95);
            line-height: 1.3;
        }
        
        .contact-info a,
        .contact-info span {
            color: white;
            text-decoration: none;
            display: inline-block;
            margin-right: 10px;
            margin-bottom: 3px;
            padding: 2px 8px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            word-wrap: break-word;
        }
        
        /* Summary Section */
        .summary-section {
            margin: 0 15px 8px 15px; /* Further reduced margins */
            padding: 8px 12px; /* Further reduced padding */
            background: #f7fafc;
            border-left: 3px solid {{ accent_color|default:'#667eea' }};
            border-radius: 6px;
        }
        
        .summary {
            font-size: 8pt; /* Reduced */
            line-height: 1.3; /* Tighter */
            color: #4a5568;
            word-wrap: break-word;
        }
        
        /* Two-column layout using floats */
        .two-column {
            width: 100%;
            padding: 0 15px 6px 15px; /* Further reduced padding */
            overflow: hidden;
        }
        
        .column-left {
            width: 58%;
            float: left;
            padding-right: 12px;
        }
        
        .column-right {
            width: 42%;
            float: left;
            padding-left: 12px;
        }
        
        /* Sections */
        .section {
            margin-bottom: 8px; /* Further reduced */
            page-break-inside: avoid;
            page-break-after: avoid; /* Prevent page break */
        }
        
        .section-title {
            font-size: 9.5pt; /* Further reduced */
            font-weight: 700;
            color: #1a202c;
            margin-bottom: 4px; /* Further reduced */
            padding-bottom: 2px; /* Further reduced */
            border-bottom: 2px solid {{ accent_color|default:'#667eea' }};
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* Items - Experience, Education */
        .item {
            margin-bottom: 6px; /* Further reduced */
            padding: 6px 8px; /* Further reduced padding */
            background: white;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
            border-left: 3px solid {{ accent_color|default:'#667eea' }};
            page-break-inside: avoid;
        }
        
        .item-header {
            margin-bottom: 6px;
            overflow: hidden;
        }
        
        .item-title-row {
            width: 100%;
            margin-bottom: 4px;
        }
        
        .item-title {
            font-weight: 700;
            font-size: 9pt; /* Further reduced */
            color: #1a202c;
            line-height: 1.15; /* Tighter */
            margin-bottom: 1px; /* Reduced */
            word-wrap: break-word;
        }
        
        .item-subtitle {
            color: #718096;
            font-size: 7.5pt; /* Further reduced */
            font-weight: 500;
            word-wrap: break-word;
            line-height: 1.2;
        }
        
        .item-date {
            color: {{ accent_color|default:'#667eea' }};
            font-weight: 600;
            font-size: 7pt; /* Further reduced */
            background: rgba(102, 126, 234, 0.1);
            padding: 1px 6px; /* Reduced padding */
            border-radius: 10px;
            display: inline-block;
            margin-top: 2px; /* Reduced */
        }
        
        .item-description {
            margin-top: 3px; /* Further reduced */
            color: #4a5568;
            font-size: 7pt; /* Further reduced */
            line-height: 1.2; /* Very tight */
            word-wrap: break-word;
        }
        
        .item-description ul {
            padding-left: 12px; /* Further reduced */
            margin: 0;
        }
        
        .item-description li {
            margin-bottom: 0.5px; /* Very minimal */
            word-wrap: break-word;
            line-height: 1.2;
        }
        
        .grade-info {
            margin-top: 4px;
            color: #4a5568;
            font-size: 8pt;
            word-wrap: break-word;
        }
        
        .grade-info strong {
            color: {{ accent_color|default:'#667eea' }};
        }
        
        /* Projects */
        .project-item {
            margin-bottom: 6px; /* Further reduced */
            padding: 6px 8px; /* Further reduced padding */
            background: white;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
            border-left: 3px solid {{ accent_color|default:'#667eea' }};
            page-break-inside: avoid;
        }
        
        .project-tech {
            margin-top: 4px; /* Further reduced */
            font-size: 7pt; /* Further reduced */
            color: #718096;
            padding-top: 4px; /* Further reduced */
            border-top: 1px solid #e2e8f0;
            word-wrap: break-word;
            line-height: 1.2;
        }
        
        .project-tech strong {
            color: {{ accent_color|default:'#667eea' }};
            font-weight: 600;
        }
        
        .project-link {
            color: {{ accent_color|default:'#667eea' }};
            text-decoration: none;
            font-weight: 500;
            word-wrap: break-word;
        }
        
        /* Skills */
        .skills-container {
            width: 100%;
        }
        
        .skill-category {
            margin-bottom: 6px; /* Further reduced */
        }
        
        .skill-category:last-child {
            margin-bottom: 0;
        }
        
        .skill-category-title {
            font-weight: 700;
            color: #1a202c;
            font-size: 8.5pt; /* Further reduced */
            margin-bottom: 4px; /* Further reduced */
            padding-bottom: 2px; /* Further reduced */
            border-bottom: 2px solid #e2e8f0;
        }
        
        .skill-item {
            margin-bottom: 8px;
            width: 100%;
            overflow: hidden;
        }
        
        .skill-name {
            font-size: 8pt;
            color: #4a5568;
            font-weight: 500;
            float: left;
            width: 80px;
            word-wrap: break-word;
        }
        
        .skill-bar-container {
            float: left;
            padding: 0 8px;
            width: 60%;
            min-width: 100px;
        }
        
        .skill-bar-wrapper {
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .skill-bar {
            height: 100%;
            background: {{ accent_color|default:'#667eea' }};
            border-radius: 4px;
            width: 85%;
        }
        
        .skill-level {
            font-size: 7.5pt;
            color: {{ accent_color|default:'#667eea' }};
            font-weight: 600;
            float: right;
            width: 40px;
            text-align: right;
            line-height: 16px;
        }
        
        /* Languages */
        .languages-container {
            width: 100%;
        }
        
        .language-item {
            width: 100%;
            margin-bottom: 6px; /* Further reduced */
            padding: 6px 8px; /* Further reduced padding */
            background: #f7fafc;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
            overflow: hidden;
        }
        
        .language-item:last-child {
            margin-bottom: 0;
        }
        
        .language-name {
            font-weight: 600;
            color: #1a202c;
            font-size: 8.5pt;
            float: left;
            width: 80px;
            word-wrap: break-word;
        }
        
        .proficiency-dots {
            float: left;
            padding: 0 8px;
            line-height: 16px;
        }
        
        .dot {
            display: inline-block;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            margin-right: 3px;
        }
        
        .dot-filled {
            background: {{ accent_color|default:'#667eea' }};
        }
        
        .dot-empty {
            background: #e2e8f0;
            border: 1px solid #cbd5e0;
        }
        
        .proficiency-text {
            color: #718096;
            font-size: 7.5pt;
            float: right;
            text-align: right;
            width: 70px;
            line-height: 16px;
            word-wrap: break-word;
        }
        
        /* Certifications & Achievements */
        .certs-container,
        .achievements-container {
            width: 100%;
        }
        
        .cert-item,
        .achieve-item {
            padding: 6px 8px; /* Further reduced padding */
            background: #f7fafc;
            border-radius: 6px;
            border-left: 3px solid {{ accent_color|default:'#667eea' }};
            font-size: 7.5pt; /* Further reduced */
            line-height: 1.2; /* Tighter */
            margin-bottom: 4px; /* Further reduced */
            word-wrap: break-word;
        }
        
        .cert-item:last-child,
        .achieve-item:last-child {
            margin-bottom: 0;
        }
        
        .cert-item strong,
        .achieve-item strong {
            color: #1a202c;
            font-weight: 700;
            display: block;
            margin-bottom: 2px;
        }
        
        .cert-item em,
        .achieve-item em {
            color: #718096;
            font-style: normal;
        }
        
        /* Hobbies */
        .hobbies {
            line-height: 1.8;
        }
        
        .hobby-tag {
            display: inline-block;
            padding: 4px 10px;
            background: {{ accent_color|default:'#667eea' }};
            color: white;
            border-radius: 15px;
            font-size: 7.5pt;
            font-weight: 500;
            margin-right: 6px;
            margin-bottom: 4px;
            word-wrap: break-word;
        }
        
        /* Clear floats */
        .clearfix::after {
            content: "";
            display: table;
            clear: both;
        }
        
        /* Print optimizations */
        @media print {
            .resume-container {
                padding: 0;
            }
            .section {
                page-break-inside: avoid;
            }
            .item,
            .project-item,
            .language-item,
            .cert-item,
            .achieve-item,
            .skill-category {
                page-break-inside: avoid;
            }
        }
    </style>
    <!-- JavaScript-based dynamic font sizing for single page -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const container = document.querySelector('.resume-container');
        
        if (!container) return;
        
        function adjustFontSizes() {
            const maxHeight = 286; // mm
            const maxHeightPx = maxHeight * 3.779527559; // Convert mm to px
            
            let scaleFactor = 1;
            let attempts = 0;
            const maxAttempts = 10;
            
            while (attempts < maxAttempts) {
                const actualHeight = container.scrollHeight || container.offsetHeight;
                
                if (actualHeight <= maxHeightPx) {
                    // Content fits, increase font size if there's extra space
                    const extraSpace = (maxHeightPx - actualHeight) / maxHeightPx;
                    if (extraSpace > 0.1 && scaleFactor < 1.4) {
                        scaleFactor += 0.02;
                        document.documentElement.style.setProperty('--scale-factor', scaleFactor);
                        updateFontSizes(scaleFactor);
                    } else {
                        break;
                    }
                } else {
                    // Content overflows, decrease font size
                    scaleFactor -= 0.02;
                    if (scaleFactor < 0.8) scaleFactor = 0.8; // Minimum scale
                    document.documentElement.style.setProperty('--scale-factor', scaleFactor);
                    updateFontSizes(scaleFactor);
                }
                
                attempts++;
            }
        }
        
        function updateFontSizes(scale) {
            document.body.style.fontSize = (8.5 * scale) + 'pt';
            const styles = {
                '.name': (22 * scale) + 'pt',
                '.contact-info': (7 * scale) + 'pt',
                '.summary': (8 * scale) + 'pt',
                '.section-title': (9.5 * scale) + 'pt',
                '.item-title': (9 * scale) + 'pt',
                '.item-subtitle': (7.5 * scale) + 'pt',
                '.item-date': (7 * scale) + 'pt',
                '.item-description': (7 * scale) + 'pt',
                '.item-description li': (7 * scale) + 'pt',
                '.grade-info': (8 * scale) + 'pt',
                '.project-tech': (7 * scale) + 'pt',
                '.skill-category-title': (8.5 * scale) + 'pt',
                '.skill-name': (8 * scale) + 'pt',
                '.skill-level': (7.5 * scale) + 'pt',
                '.language-name': (8.5 * scale) + 'pt',
                '.proficiency-text': (7.5 * scale) + 'pt',
                '.cert-item, .achieve-item': (7.5 * scale) + 'pt',
                '.hobby-tag': (7.5 * scale) + 'pt'
            };
            
            for (const [selector, fontSize] of Object.entries(styles)) {
                const elements = document.querySelectorAll(selector);
                elements.forEach(el => {
                    el.style.fontSize = fontSize;
                });
            }
        }
        
        // Initial adjustment
        setTimeout(adjustFontSizes, 100);
        // Re-adjust after a short delay to ensure content is rendered
        setTimeout(adjustFontSizes, 500);
    });
    </script>
</head>
<body>
    <div class="resume-container">
        <!-- Header -->
        <div class="header">
            <h1 class="name">{{ resume.profile.full_name|default:resume.profile.user.username }}</h1>
            <div class="contact-info">
                {% if resume.profile.phone_number %}<a href="tel:{{ resume.profile.phone_number }}">{{ resume.profile.phone_number }}</a>{% endif %}
                {% if resume.profile.user.email %}<a href="mailto:{{ resume.profile.user.email }}">{{ resume.profile.user.email }}</a>{% endif %}
                {% if resume.profile.address %}<span>{{ resume.profile.address }}</span>{% endif %}
                {% if resume.profile.portfolio_url %}<a href="{{ resume.profile.portfolio_url }}">Portfolio</a>{% endif %}
                {% if resume.profile.linkedin_url %}<a href="{{ resume.profile.linkedin_url }}">LinkedIn</a>{% endif %}
            </div>
        </div>

        <!-- Professional Summary -->
        {% if resume.profile.professional_summary %}
        <div class="summary-section">
            <div class="summary">
                {{ resume.profile.professional_summary|linebreaksbr }}
            </div>
        </div>
        {% endif %}

        <!-- Main Content: Two Column Layout -->
        <div class="two-column clearfix">
            <!-- Left Column -->
            <div class="column-left">
                <!-- Experience -->
                {% if experiences %}
                <div class="section">
                    <h2 class="section-title">Experience</h2>
                    {% for exp in experiences %}
                    <div class="item">
                        <div class="item-header">
                            <div class="item-title-row">
                                <div class="item-title">{{ exp.job_title }}</div>
                                <div class="item-subtitle">{{ exp.company }}{% if exp.location %}, {{ exp.location }}{% endif %}</div>
                                <div class="item-date">{{ exp.start_date|date:"M Y" }} - {% if exp.end_date %}{{ exp.end_date|date:"M Y" }}{% else %}Present{% endif %}</div>
                            </div>
                        </div>
                        {% if exp.description_points %}
                        <div class="item-description">
                            <ul>
                                {% for point in exp.description_points %}
                                <li>{{ point }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
                {% endif %}

                <!-- Education -->
                {% if educations %}
                <div class="section">
                    <h2 class="section-title">Education</h2>
                    {% for edu in educations %}
                    <div class="item">
                        <div class="item-header">
                            <div class="item-title-row">
                                <div class="item-title">{{ edu.degree }}{% if edu.field_of_study %} in {{ edu.field_of_study }}{% endif %}</div>
                                <div class="item-subtitle">{{ edu.institution }}{% if edu.address %}, {{ edu.address }}{% endif %}</div>
                                <div class="item-date">{{ edu.start_date|date:"M Y" }} - {% if edu.end_date %}{{ edu.end_date|date:"M Y" }}{% else %}Present{% endif %}</div>
                            </div>
                        </div>
                        {% if edu.percentage %}
                        <div class="grade-info">
                            <strong>Grade:</strong> {{ edu.percentage }}
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
                {% endif %}

                <!-- Projects -->
                {% if projects %}
                <div class="section">
                    <h2 class="section-title">Projects</h2>
                    {% for p in projects %}
                    <div class="project-item">
                        <div class="item-title">{{ p.title }}</div>
                        {% if p.aim %}
                        <div class="item-subtitle" style="margin-top: 6px;">{{ p.aim }}</div>
                        {% endif %}
                        {% if p.description_points %}
                        <div class="item-description" style="margin-top: 10px;">
                            <ul>
                                {% for point in p.description_points %}
                                <li>{{ point }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                        {% endif %}
                        <div class="project-tech">
                            {% if p.frontend %}<strong>Frontend:</strong> {{ p.frontend }}{% if p.backend or p.database %} | {% endif %}{% endif %}
                            {% if p.backend %}<strong>Backend:</strong> {{ p.backend }}{% if p.database %} | {% endif %}{% endif %}
                            {% if p.database %}<strong>Database:</strong> {{ p.database }}{% endif %}
                            {% if p.link %}<br><strong>Link:</strong> <a href="{{ p.link }}" class="project-link">{{ p.link }}</a>{% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
            </div>

            <!-- Right Column -->
            <div class="column-right">
                <!-- Skills -->
                {% if skills_by_category %}
                <div class="section">
                    <h2 class="section-title">Skills</h2>
                    <div class="skills-container">
                        {% for category, skills in skills_by_category.items %}
                        <div class="skill-category">
                            <div class="skill-category-title">{{ category }}</div>
                            {% for skill in skills %}
                            <div class="skill-item clearfix">
                                <span class="skill-name">{{ skill }}</span>
                                <span class="skill-bar-container">
                                    <div class="skill-bar-wrapper">
                                        <span class="skill-bar"></span>
                                    </div>
                                </span>
                                <span class="skill-level">85%</span>
                            </div>
                            {% endfor %}
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <!-- Languages -->
                {% if languages %}
                <div class="section">
                    <h2 class="section-title">Languages</h2>
                    <div class="languages-container">
                        {% for lang in languages %}
                        <div class="language-item clearfix">
                            <span class="language-name">{{ lang.name }}</span>
                            <span class="proficiency-dots">
                                {% if lang.proficiency == 'Fluent' %}
                                    <span class="dot dot-filled"></span><span class="dot dot-filled"></span><span class="dot dot-filled"></span><span class="dot dot-filled"></span><span class="dot dot-filled"></span>
                                {% elif lang.proficiency == 'Advanced' %}
                                    <span class="dot dot-filled"></span><span class="dot dot-filled"></span><span class="dot dot-filled"></span><span class="dot dot-filled"></span><span class="dot dot-empty"></span>
                                {% elif lang.proficiency == 'Intermediate' %}
                                    <span class="dot dot-filled"></span><span class="dot dot-filled"></span><span class="dot dot-filled"></span><span class="dot dot-empty"></span><span class="dot dot-empty"></span>
                                {% else %}
                                    <span class="dot dot-filled"></span><span class="dot dot-filled"></span><span class="dot dot-empty"></span><span class="dot dot-empty"></span><span class="dot dot-empty"></span>
                                {% endif %}
                            </span>
                            <span class="proficiency-text">({{ lang.get_proficiency_display }})</span>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <!-- Certifications -->
                {% if certifications %}
                <div class="section">
                    <h2 class="section-title">Certifications</h2>
                    <div class="certs-container">
                        {% for cert in certifications %}
                        <div class="cert-item">
                            <strong>{{ cert.name }}</strong>
                            <em>{{ cert.issuing_organization }}</em>
                            {% if cert.date_issued %} ({{ cert.date_issued|date:"M Y" }}){% endif %}
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <!-- Achievements -->
                {% if achievements %}
                <div class="section">
                    <h2 class="section-title">Achievements</h2>
                    <div class="achievements-container">
                        {% for a in achievements %}
                        <div class="achieve-item">
                            {% if a.name %}<strong>{{ a.name }}</strong>{% endif %}
                            {{ a.description }}
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <!-- Hobbies -->
                {% if hobbies %}
                <div class="section">
                    <h2 class="section-title">Hobbies</h2>
                    <div class="hobbies">
                        {% for hobby in hobbies %}
                        <span class="hobby-tag">{{ hobby }}</span>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</body>
</html>
