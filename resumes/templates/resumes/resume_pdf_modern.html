<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>{{ resume.profile.full_name }}'s Resume</title>
    <style>
    /* Final robust version for multi-page PDF rendering using a table layout */
        @page {
            size: a4;
            margin: 0;
        }
        body { 
            font-family: 'Helvetica', Arial, sans-serif; 
            color: #333; 
            font-size: 9.5pt;
            line-height: 1.4;
            margin: 0; 
            padding: 0; 
        }
        /* The main layout table */
        .resume-layout {
            width: 100%;
            height: 100%;
            border-collapse: collapse;
        }
        /* The sidebar cell */
        .sidebar { 
            width: 32%;
            background: #2c3e50;
            color: #ffffff;
            vertical-align: top;
            padding: 1cm; /* Padding is now on the cell itself */
        }
        /* The main content cell */
        .content { 
            width: 68%; 
            vertical-align: top;
            padding: 1cm; /* Padding is now on the cell itself */
        }
        .name { 
            font-size: 24pt;
            color: #2c3e50; 
            font-weight: bold; 
            margin-bottom: 8px; 
            line-height: 1.2;
        }
        .sidebar h2 { 
            font-size: 10pt;
            color: #ffffff; 
            margin: 18px 0 8px 0; 
            text-transform: uppercase; 
            border-bottom: 1px solid #7f8c8d; 
            padding-bottom: 4px;
            letter-spacing: 1px;
            page-break-after: avoid;
        }
        .content h2 { 
            font-size: 12pt;
            color: #2c3e50; 
            margin: 18px 0 12px 0;
            border-bottom: 2px solid #3498db;
            padding-bottom: 4px;
            text-transform: uppercase;
            letter-spacing: 1px;
            page-break-after: avoid;
        }
        .title { font-size: 10.5pt; font-weight: bold; margin: 2px 0; }
        .subtitle { font-size: 9.5pt; color: #444; margin: 2px 0 5px 0; font-style: italic; }
        .date { font-size: 9pt; color: #666; float: right; }
        .description { text-align: justify; white-space: pre-wrap; clear: both; }
        .item { margin-bottom: 12px; page-break-inside: avoid; }
        .sidebar-list { margin:0; padding:0; list-style: none; font-size: 9pt; }
        .sidebar-list li { margin-bottom: 10px; }
        .tech-details { font-size: 8.5pt; color: #444; margin-top: 4px; }
        .profile-photo { width: 120px; height: 120px; object-fit: cover; border-radius: 50%; border: 4px solid #ffffff; }
        a { color: #3498db; text-decoration: none; }
        .sidebar a { color: #ffffff; }
    </style>
</head>
<body>
    <table class="resume-layout">
        <tr>
            <td class="sidebar">
                {% if resume.profile.profile_photo %}
                    <div style="text-align:center; margin-bottom:20px;">
                        <img class="profile-photo" src="{{ resume.profile.profile_photo.url }}" alt="{{ resume.profile.full_name }}">
                    </div>
                {% endif %}
                
                {% if resume.profile.phone_number or resume.profile.user.email or resume.profile.address or resume.profile.portfolio_url %}
                <h2>Contact</h2>
                <ul class="sidebar-list">
                    {% if resume.profile.phone_number %}<li><strong>Phone:</strong><br><a href="tel:{{ resume.profile.phone_number }}">{{ resume.profile.phone_number }}</a></li>{% endif %}
                    {% if resume.profile.user.email %}<li><strong>Email:</strong><br><a href="mailto:{{ resume.profile.user.email }}">{{ resume.profile.user.email }}</a></li>{% endif %}
                    {% if resume.profile.address %}<li><strong>Address:</strong><br>{{ resume.profile.address }}</li>{% endif %}
                    {% if resume.profile.portfolio_url %}<li><strong>Portfolio:</strong><br><a href="{{ resume.profile.portfolio_url }}" style="word-break: break-all;">{{ resume.profile.portfolio_url }}</a></li>{% endif %}
                    {% if resume.profile.linkedin_url %}<li><strong>LinkedIn:</strong><br><a href="{{ resume.profile.linkedin_url }}" style="word-break: break-all;">{{ resume.profile.linkedin_url }}</a></li>{% endif %}
                </ul>
                {% endif %}

                {% if educations %}
                    <h2>Education</h2>
                    <ul class="sidebar-list">
                    {% for edu in educations %}
                        <li>
                            <strong>{{ edu.degree }}</strong><br>
                            <span style="font-size: 9pt;">{{ edu.institution }}</span><br>
                            <span style="font-size: 8.5pt;">{{ edu.start_date|date:"Y" }} - {{ edu.end_date|date:"Y"|default:"Present" }}</span>
                        </li>
                    {% endfor %}
                    </ul>
                {% endif %}

                {% if skills_by_category %}
                    <h2>Skills</h2>
                    {% for cat, skills in skills_by_category.items %}
                        <p style="margin: 5px 0;"><strong>{{ cat }}:</strong><br><span style="font-size: 9.5pt;">{{ skills|join:", " }}</span></p>
                    {% endfor %}
                {% endif %}
                
                {% if certifications %}
                    <h2>Certifications</h2>
                    <ul class="sidebar-list">
                    {% for cert in certifications %}
                        <li>
                            <strong>{{ cert.name }}</strong><br>
                            <span style="font-size: 9pt;">{{ cert.issuing_organization }}</span>
                        </li>
                    {% endfor %}
                    </ul>
                {% endif %}

                {% if languages %}
                    <h2>Languages</h2>
                    <ul class="sidebar-list">
                        {% for lang in languages %}
                            <li>{{ lang.name }} ({{ lang.get_proficiency_display }})</li>
                        {% endfor %}
                    </ul>
                {% endif %}
            </td>
            <td class="content">
                <div class="name">{{ resume.profile.full_name|default:resume.profile.user.username }}</div>

                {% if resume.profile.professional_summary %}
                    <div class="section">
                        <h2>Summary</h2>
                        <div class="description">{{ resume.profile.professional_summary|linebreaksbr }}</div>
                    </div>
                {% endif %}

                {% if experiences %}
                    <div class="section">
                        <h2>Experience</h2>
                        {% for e in experiences %}
                            <div class="item">
                                <p style="margin:0; padding:0;"><span class="date">{{ e.start_date|date:"M Y" }} - {% if e.end_date %}{{ e.end_date|date:"M Y" }}{% else %}Present{% endif %}</span><span class="title">{{ e.job_title }}</span></p>
                                <p class="subtitle" style="margin:0 0 5px 0;">{{ e.company }}</p>
                                <div class="description">{{ e.description|linebreaksbr }}</div>
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
                
                {% if projects %}
                    <div class="section">
                        <h2>Projects</h2>
                        {% for p in projects %}
                            <div class="item">
                                <p class="title">{{ p.title }}</p>
                                {% if p.aim %}<p class="subtitle">{{ p.aim }}</p>{% endif %}
                                <div class="description">{{ p.description|linebreaksbr }}</div>
                                <div class="tech-details">
                                    {% if p.frontend %}<strong>Frontend:</strong> {{ p.frontend }}<br>{% endif %}
                                    {% if p.backend %}<strong>Backend:</strong> {{ p.backend }}<br>{% endif %}
                                    {% if p.database %}<strong>Database:</strong> {{ p.database }}<br>{% endif %}
                                    {% if p.link %}<strong>Link:</strong> <a href="{{ p.link }}">{{ p.link }}</a>{% endif %}
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}

                {% if achievements %}
                    <div class="section">
                        <h2>Achievements</h2>
                        <ul style="padding-left: 18px; margin-top: 5px;">
                        {% for a in achievements %}
                            <li>{% if a.name %}<strong>{{ a.name }}:</strong> {% endif %}{{ a.description }}</li>
                        {% endfor %}
                        </ul>
                    </div>
                {% endif %}
            </td>
        </tr>
    </table>
</body>
</html>
