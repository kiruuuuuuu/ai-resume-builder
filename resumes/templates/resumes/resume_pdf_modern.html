<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>{{ resume.profile.full_name }}'s Resume</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');

        @page {
            size: a4;
            margin: 0;
        }
        html, body {
            font-family: 'Inter', Arial, sans-serif;
            color: #3a3a3a;
            font-size: 12pt; /* Base font size - will scale dynamically */
            line-height: 1.4; /* Comfortable line height */
            margin: 0;
            padding: 0;
            width: 210mm;
            height: 297mm;
            -webkit-print-color-adjust: exact;
        }
        /* Dynamic font sizing - adjust based on content */
        :root {
            --base-font-size: 12pt;
            --scale-factor: 1;
        }
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        .page {
            width: 100%;
            height: 297mm; /* Fixed A4 page height - single page */
            max-height: 297mm; /* Maximum A4 page height - single page */
            overflow: hidden; /* Prevent overflow */
            position: relative;
            page-break-after: avoid; /* Prevent page break */
            page-break-inside: avoid; /* Prevent page break */
            display: flex; /* Use flexbox for better control */
        }
        .page::after {
            content: "";
            display: table;
            clear: both;
        }
        .sidebar {
            width: 35%;
            float: left;
            min-height: 297mm; /* Minimum height */
            max-height: 297mm; /* Maximum height */
            background-color: {{ accent_color|default:'#2c3e50' }} !important;
            color: #f0f0f0;
            padding: 15px 12px; /* Reduced padding to minimize gaps */
            box-sizing: border-box;
            position: relative;
            overflow: hidden; /* Prevent overflow */
            display: flex;
            flex-direction: column;
        }
        .content {
            width: 65%;
            float: left;
            min-height: 297mm; /* Minimum height */
            max-height: 297mm; /* Maximum height */
            padding: 15px 12px; /* Reduced padding to minimize gaps */
            box-sizing: border-box;
            position: relative;
            overflow: hidden; /* Prevent overflow */
            display: flex;
            flex-direction: column;
        }
        .clearfix::after {
            content: "";
            display: table;
            clear: both;
        }
        a {
            text-decoration: none;
            color: {{ accent_color|default:'#3498db' }};
        }
        .sidebar a {
            color: #ecf0f1;
        }

        /* --- Sidebar Styling --- */
        .profile-photo-container {
            text-align: center;
            margin-bottom: 8px; /* Reduced gap */
            flex-shrink: 0;
        }
        .profile-photo {
            width: 70px; /* Slightly larger */
            height: 70px; /* Slightly larger */
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        .sidebar h2 {
            font-size: 11pt; /* Increased font size */
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #ffffff;
            border-bottom: 1px solid #7f8c8d;
            padding-bottom: 3px;
            margin: 6px 0 4px 0; /* Reduced gaps between sections */
            font-weight: 700;
            flex-shrink: 0;
        }
        .contact-item, .sidebar-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 3px; /* Reduced gap */
            font-size: 10pt; /* Increased font size */
            line-height: 1.3; /* Comfortable line height */
        }
        .contact-item svg {
            width: 12px;
            height: 12px;
            margin-right: 10px;
            flex-shrink: 0;
            margin-top: 3px;
        }
        .contact-item-text { word-break: break-all; }
        .skill-category {
            margin-bottom: 5px; /* Reduced gap */
        }
        .skill-category strong {
            display: block;
            color: #ffffff;
            margin-bottom: 2px;
            font-size: 10.5pt; /* Increased font size */
            font-weight: 500;
        }
        .skill-category span {
            font-size: 10pt; /* Increased font size */
            color: #bdc3c7;
            line-height: 1.3;
        }

        /* --- Main Content Styling --- */
        .name {
            font-size: 28pt; /* Increased font size */
            font-weight: bold;
            color: #2c3e50;
            line-height: 1.1;
            margin-bottom: 2px; /* Reduced gap */
            flex-shrink: 0;
        }
        .job-title-header {
            font-size: 14pt; /* Increased font size */
            color: {{ accent_color|default:'#3498db' }};
            font-weight: 500;
            margin-bottom: 6px; /* Reduced gap */
            flex-shrink: 0;
        }
        .content h2 {
            font-size: 12pt; /* Increased font size */
            color: #2c3e50;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 1.5px solid {{ accent_color|default:'#3498db' }};
            padding-bottom: 2px; /* Reduced padding */
            margin: 2px 0 -2px 0 !important; /* Negative bottom margin to eliminate gaps */
            line-height: 1.1 !important; /* Tight line height to reduce spacing */
            font-weight: 700;
            flex-shrink: 0;
        }
        .item {
            margin-bottom: 2px; /* Minimal gap between items */
            margin-top: 0 !important; /* Force no top margin */
            padding-top: 0;
            page-break-inside: avoid;
        }
        /* Aggressively remove margin from first item in each section */
        section > .item:first-child {
            margin-top: 0 !important;
            padding-top: 0 !important;
        }
        /* Reduce spacing for list items within achievements/certifications */
        section > .description-list {
            margin-top: -1px !important; /* Negative margin to eliminate gap after h2 */
            padding-top: 0;
        }
        /* Reduce spacing between consecutive items */
        .item + .item {
            margin-top: 0 !important; /* No spacing between consecutive items */
        }
        /* Aggressively ensure no gap after h2 before first content */
        section h2 + .item,
        section h2 + .description-list,
        section h2 + div {
            margin-top: 0 !important;
            padding-top: 0 !important;
        }
        /* Remove ALL margins/padding from section that might create gaps */
        section {
            padding-top: 0 !important;
            padding-bottom: 0 !important;
            margin-top: 0;
            margin-bottom: 0;
        }
        /* Force items to have zero spacing */
        section .item {
            margin-top: 0 !important;
            padding-top: 0 !important;
        }
        /* Remove default margins from p, ul, li elements inside sections */
        section p,
        section ul,
        section li {
            margin-top: 0;
            margin-bottom: 0;
            padding-top: 0;
        }
        /* Remove spacing from subtitle and project-aim after h2 */
        section h2 + * .subtitle,
        section h2 + * .project-aim {
            margin-top: 0;
        }
        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        .title {
            font-size: 12pt; /* Increased font size */
            font-weight: 700;
            color: #000;
        }
        .subtitle, .project-aim {
            font-size: 11pt; /* Increased font size */
            color: #555;
            font-style: italic;
            margin-top: 0;
            margin-bottom: 2px; /* Minimal margin */
            line-height: 1.2; /* Tighter line height */
        }
        .project-aim {
            font-style: normal;
        }
        .date {
            font-size: 10.5pt; /* Increased font size */
            color: #333;
            font-weight: 500;
            flex-shrink: 0;
            padding-left: 10px;
        }
        .description-list {
            margin: 0 !important; /* Zero margin - no gap */
            padding-left: 14px;
            padding-top: 0;
            list-style-type: disc;
            list-style-position: outside;
        }
        .description-list li {
            margin-bottom: 1px; /* Minimal gap between items */
            margin-top: 0;
            padding-left: 2px;
            padding-top: 0;
            text-align: justify;
            line-height: 1.25; /* Tighter line height */
            font-size: 10pt; /* Increased font size */
        }
        .tech-details {
            font-size: 10pt; /* Increased font size */
            color: #444;
            margin-top: 0 !important; /* Zero margin */
            margin-bottom: 0;
            padding-top: 0;
            line-height: 1.25; /* Tighter line height */
        }
        section {
            page-break-inside: avoid;
            page-break-after: avoid;
            margin-bottom: 2px !important; /* Minimal margin between sections */
            margin-top: 0 !important; /* No top margin */
            padding-top: 0 !important; /* No padding top */
            padding-bottom: 0 !important;
            flex: 1 1 auto; /* Allow sections to grow/shrink */
        }
        /* Global reset for content area to eliminate all gaps */
        .content * {
            box-sizing: border-box;
        }
        .content section,
        .content section * {
            margin-top: 0;
        }
        /* Force immediate children after h2 to have no gap */
        .content section h2 ~ * {
            margin-top: 0 !important;
            padding-top: 0 !important;
        }
    </style>
    <!-- JavaScript-based dynamic font sizing for single page -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const page = document.querySelector('.page');
        const contentArea = document.querySelector('.content');
        const sidebar = document.querySelector('.sidebar');
        
        if (!page || !contentArea) return;
        
        function adjustFontSizes() {
            const pageHeight = 297; // mm
            const maxHeight = pageHeight * 3.779527559; // Convert mm to px (1mm = 3.779527559px)
            
            let scaleFactor = 1;
            let attempts = 0;
            const maxAttempts = 10;
            
            while (attempts < maxAttempts) {
                const actualHeight = Math.max(
                    contentArea.scrollHeight || contentArea.offsetHeight,
                    sidebar.scrollHeight || sidebar.offsetHeight
                );
                
                if (actualHeight <= maxHeight) {
                    // Content fits, increase font size if there's extra space
                    const extraSpace = (maxHeight - actualHeight) / maxHeight;
                    if (extraSpace > 0.1 && scaleFactor < 1.3) {
                        scaleFactor += 0.02;
                        document.documentElement.style.setProperty('--scale-factor', scaleFactor);
                        updateFontSizes(scaleFactor);
                    } else {
                        break;
                    }
                } else {
                    // Content overflows, decrease font size
                    scaleFactor -= 0.02;
                    if (scaleFactor < 0.85) scaleFactor = 0.85; // Minimum scale
                    document.documentElement.style.setProperty('--scale-factor', scaleFactor);
                    updateFontSizes(scaleFactor);
                }
                
                attempts++;
            }
        }
        
        function updateFontSizes(scale) {
            document.body.style.fontSize = (12 * scale) + 'pt';
            const styles = {
                '.sidebar h2': (11 * scale) + 'pt',
                '.contact-item, .sidebar-item': (10 * scale) + 'pt',
                '.skill-category strong': (10.5 * scale) + 'pt',
                '.skill-category span': (10 * scale) + 'pt',
                '.name': (28 * scale) + 'pt',
                '.job-title-header': (14 * scale) + 'pt',
                '.content h2': (12 * scale) + 'pt',
                '.title': (12 * scale) + 'pt',
                '.subtitle, .project-aim': (11 * scale) + 'pt',
                '.date': (10.5 * scale) + 'pt',
                '.description-list li': (10 * scale) + 'pt',
                '.tech-details': (10 * scale) + 'pt'
            };
            
            for (const [selector, fontSize] of Object.entries(styles)) {
                const elements = document.querySelectorAll(selector);
                elements.forEach(el => {
                    el.style.fontSize = fontSize;
                });
            }
        }
        
        // Initial adjustment
        setTimeout(adjustFontSizes, 100);
        // Re-adjust after a short delay to ensure content is rendered
        setTimeout(adjustFontSizes, 500);
    });
    </script>
</head>
<body>
    <div class="page clearfix">
        <div class="sidebar">
            {% if resume.profile.profile_photo %}
            <div class="profile-photo-container">
                <img class="profile-photo" src="{{ resume.profile.profile_photo.url }}" alt="Profile Photo">
            </div>
            {% endif %}

            {% if resume.profile.phone_number or resume.profile.user.email or resume.profile.address or resume.profile.linkedin_url or resume.profile.portfolio_url %}
            <h2>Contact</h2>
            {% if resume.profile.phone_number %}<div class="contact-item"><svg viewBox="0 0 24 24"><path fill="#95a5a6" d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/></svg><div class="contact-item-text"><a href="tel:{{ resume.profile.phone_number }}">{{ resume.profile.phone_number }}</a></div></div>{% endif %}
            {% if resume.profile.user.email %}<div class="contact-item"><svg viewBox="0 0 24 24"><path fill="#95a5a6" d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg><div class="contact-item-text"><a href="mailto:{{ resume.profile.user.email }}">{{ resume.profile.user.email }}</a></div></div>{% endif %}
            {% if resume.profile.address %}<div class="contact-item"><svg viewBox="0 0 24 24"><path fill="#95a5a6" d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg><div class="contact-item-text">{{ resume.profile.address }}</div></div>{% endif %}
            {% if resume.profile.linkedin_url %}<div class="contact-item"><svg viewBox="0 0 24 24"><path fill="#95a5a6" d="M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77z"/></svg><div class="contact-item-text"><a href="{{ resume.profile.linkedin_url }}">LinkedIn</a></div></div>{% endif %}
            {% if resume.profile.portfolio_url %}<div class="contact-item"><svg viewBox="0 0 24 24"><path fill="#95a5a6" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 14.5v-9l6 4.5-6 4.5z"/></svg><div class="contact-item-text"><a href="{{ resume.profile.portfolio_url }}">Portfolio</a></div></div>{% endif %}
            {% endif %}

            {% if skills_by_category %}
            <h2>Skills</h2>
            {% for category, skills in skills_by_category.items %}<div class="skill-category"><strong>{{ category }}</strong><span>{{ skills|join:", " }}</span></div>{% endfor %}
            {% endif %}

            {% if educations %}
            <h2>Education</h2>
            {% for edu in educations %}<div class="sidebar-item"><div><strong>{{ edu.degree }}</strong><br><span style="font-size: 10.5pt;">{{ edu.institution }}</span><br><span style="font-size: 10pt; color: #bdc3c7;">{{ edu.start_date|date:"Y" }} - {{ edu.end_date|date:"Y"|default:"Present" }}</span></div></div>{% endfor %}
            {% endif %}

            {% if languages %}
            <h2>Languages</h2>
            {% for lang in languages %}<div class="sidebar-item" style="font-size: 10.5pt;">{{ lang.name }} ({{ lang.get_proficiency_display }})</div>{% endfor %}
            {% endif %}
            
            {% if hobbies %}
            <h2>Hobbies</h2>
            <div class="sidebar-item" style="font-size: 10pt; color: #bdc3c7;">{{ hobbies|join:", " }}</div>
            {% endif %}
        </div>

        <div class="content">
            <h1 class="name">{{ resume.profile.full_name|default:resume.profile.user.username }}</h1>
            {% if experiences.0.job_title %}<p class="job-title-header">{{ experiences.0.job_title }}</p>{% endif %}

            {% if resume.profile.professional_summary %}
            <section class="item"><h2>Summary</h2><div class="description" style="text-align: justify; font-size: 10.5pt; line-height: 1.4; margin-top: 2px;">{{ resume.profile.professional_summary|linebreaksbr }}</div></section>
            {% endif %}

            {% if experiences %}
            <section><h2>Experience</h2>{% for exp in experiences %}<div class="item"><div class="item-header"><span class="title">{{ exp.job_title }}</span><span class="date">{{ exp.start_date|date:"M Y" }} - {% if exp.end_date %}{{ exp.end_date|date:"M Y" }}{% else %}Present{% endif %}</span></div><p class="subtitle">{{ exp.company }}</p>{% if exp.description_points %}<ul class="description-list">{% for point in exp.description_points %}<li>{{ point }}</li>{% endfor %}</ul>{% endif %}</div>{% endfor %}</section>
            {% endif %}

            {% if projects %}
            <section><h2>Projects</h2>{% for p in projects %}<div class="item"><div class="item-header"><span class="title">{{ p.title }}</span></div>{% if p.aim %}<p class="project-aim">{{ p.aim }}</p>{% endif %}{% if p.description_points %}<ul class="description-list">{% for point in p.description_points %}<li>{{ point }}</li>{% endfor %}</ul>{% endif %}<div class="tech-details">{% if p.frontend or p.backend or p.database %}<strong>Technologies:</strong> {% if p.frontend %}{{ p.frontend }}{% if p.backend or p.database %}, {% endif %}{% endif %}{% if p.backend %}{{ p.backend }}{% if p.database %}, {% endif %}{% endif %}{% if p.database %}{{ p.database }}{% endif %}<br>{% endif %}{% if p.link %}<strong>Link:</strong> <a href="{{ p.link }}">{{ p.link }}</a>{% endif %}</div></div>{% endfor %}</section>
            {% endif %}
            
            {% if achievements or certifications %}
            <section><h2>Achievements & Certifications</h2>
                {% if achievements %}<ul class="description-list">{% for a in achievements %}<li>{% if a.name %}<strong>{{ a.name }}:</strong> {% endif %}{{ a.description }}</li>{% endfor %}</ul>{% endif %}
                {% if certifications %}<ul class="description-list" style="margin-top: 1px;">{% for cert in certifications %}<li><strong>{{ cert.name }}</strong> from <em>{{ cert.issuing_organization }}</em></li>{% endfor %}</ul>{% endif %}
            </section>
            {% endif %}
        </div>
    </div>
</body>
</html>

