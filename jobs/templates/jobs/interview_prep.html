{% extends 'base.html' %}
{% load custom_filters %}

{% block title %}Interview Preparation - {{ job_posting.title }}{% endblock %}

{% block content %}
<!-- Hero Section -->
<div class="relative bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-500 overflow-hidden">
    <div class="absolute inset-0 bg-black opacity-10"></div>
    <div class="relative max-w-7xl mx-auto px-4 py-16 text-center">
        <div class="inline-flex items-center justify-center w-20 h-20 bg-white/20 backdrop-blur-sm rounded-2xl mb-6">
            <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
            </svg>
        </div>
        <h1 class="text-5xl md:text-6xl font-bold text-white mb-4 animate-fade-in-up drop-shadow-lg">
            Interview Preparation
        </h1>
        <p class="text-xl text-indigo-100 mb-8 animate-fade-in-up delay-100">
            Personalized questions and answers for {{ job_posting.title }}
        </p>
    </div>
</div>

<div class="max-w-5xl mx-auto px-4 py-12">
    <!-- Job Information Card -->
    <div class="card mb-8 p-6 bg-gradient-to-r from-blue-50 to-indigo-50 border-2 border-blue-200">
        <div class="flex items-start justify-between flex-wrap gap-4">
            <div class="flex-1">
                <h2 class="text-2xl font-bold text-gray-900 mb-2">{{ job_posting.title }}</h2>
                <p class="text-lg text-gray-700 font-medium mb-2">{{ job_posting.employer.company_name }}</p>
                <p class="text-sm text-gray-600">
                    <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                    {{ job_posting.location|default:"Not specified" }}
                </p>
            </div>
            <a href="{% url 'jobs:my-applications' %}" class="inline-flex items-center gap-2 px-4 py-2 text-sm font-semibold text-indigo-600 bg-white border-2 border-indigo-200 rounded-lg hover:bg-indigo-50 transition-colors">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                </svg>
                Back to Applications
            </a>
        </div>
    </div>

    {% if questions %}
        <!-- Debug: Check question structure -->
        {% comment %}
        First question structure: {{ questions.0|safe }}
        {% endcomment %}
        
        <!-- Caution/Disclaimer Box -->
        <div class="bg-gradient-to-r from-amber-50 to-orange-50 border-2 border-amber-300 rounded-xl p-5 mb-6">
            <div class="flex items-start gap-3">
                <svg class="w-6 h-6 text-amber-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                </svg>
                <div>
                    <p class="text-sm font-semibold text-amber-900 mb-1">⚠️ Important Notice</p>
                    <p class="text-sm text-amber-800">These are <strong>practice questions</strong> generated by AI based on your resume and the job description. They do <strong>not represent actual interview questions</strong> from the employer. Use these questions to prepare and practice your responses, but be aware that real interview questions may differ.</p>
                </div>
            </div>
        </div>

        <!-- Info Box -->
        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-xl p-5 mb-8">
            <div class="flex items-start gap-3">
                <svg class="w-6 h-6 text-blue-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <div>
                    <p class="text-sm font-semibold text-blue-900 mb-1">Personalized Interview Questions</p>
                    <p class="text-sm text-blue-700">Based on your resume and the job requirements, here are {{ questions|length }} likely questions with STAR-method answers:</p>
                </div>
            </div>
        </div>

        <!-- Questions List -->
        <div class="space-y-6 mb-8">
            {% for item in questions %}
            <div class="border-2 border-gray-200 rounded-xl p-6 hover:border-indigo-300 hover:shadow-2xl transition-all duration-300 bg-gradient-to-br from-white to-gray-50 transform hover:-translate-y-1">
                <div class="flex items-start gap-4">
                    <div class="flex-shrink-0 w-12 h-12 bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-600 rounded-xl flex items-center justify-center text-white font-bold text-lg shadow-lg ring-4 ring-indigo-100">
                        {{ forloop.counter }}
                    </div>
                    <div class="flex-1">
                        {% comment %}Access question using get_item filter for reliable dictionary access{% endcomment %}
                        {% with question_val=item|get_item:"question" %}
                            {% if question_val %}
                                <h3 class="text-xl font-bold text-gray-900 mb-4 leading-relaxed">{{ question_val }}</h3>
                            {% elif item.question %}
                                <h3 class="text-xl font-bold text-gray-900 mb-4 leading-relaxed">{{ item.question }}</h3>
                            {% else %}
                                <h3 class="text-xl font-bold text-gray-900 mb-4 text-red-600">⚠️ Question {{ forloop.counter }} - Question text not found</h3>
                            {% endif %}
                        {% endwith %}
                        <div class="prose prose-sm max-w-none mt-4">
                            {% with answer_val=item|get_item:"answer" %}
                                {% if answer_val %}
                                    <div class="text-gray-700 whitespace-pre-line leading-relaxed text-base space-y-2">{{ answer_val|bold_star_labels|safe }}</div>
                                {% elif item.answer %}
                                    <div class="text-gray-700 whitespace-pre-line leading-relaxed text-base space-y-2">{{ item.answer|bold_star_labels|safe }}</div>
                                {% else %}
                                    <p class="text-gray-700 whitespace-pre-line leading-relaxed text-base text-red-600">⚠️ No answer provided</p>
                                {% endif %}
                            {% endwith %}
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Pro Tip Box -->
        <div class="mt-8 p-6 bg-gradient-to-r from-indigo-50 to-purple-50 border-2 border-indigo-200 rounded-xl">
            <div class="flex items-start gap-3">
                <svg class="w-6 h-6 text-indigo-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <div>
                    <p class="text-sm font-semibold text-indigo-900 mb-1">Pro Tip</p>
                    <p class="text-sm text-indigo-800">Practice these answers out loud and customize them with your own examples. The STAR method (Situation, Task, Action, Result) helps you structure clear, compelling responses that demonstrate your experience and impact. Remember, these are practice questions to help you prepare—actual interview questions may vary.</p>
                </div>
            </div>
        </div>
    {% else %}
        <!-- Error State -->
        <div class="card p-12 text-center">
            <div class="inline-flex items-center justify-center w-16 h-16 bg-red-100 rounded-full mb-4">
                <svg class="w-8 h-8 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            </div>
            <h3 class="text-2xl font-bold text-gray-900 mb-2">Unable to Generate Questions</h3>
            <p class="text-gray-600 mb-6">We couldn't generate interview questions at this time. Please try again later.</p>
            <a href="{% url 'jobs:my-applications' %}" class="inline-flex items-center gap-2 px-6 py-3 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition-colors">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                </svg>
                Back to Applications
            </a>
        </div>
    {% endif %}
</div>
{% endblock %}

