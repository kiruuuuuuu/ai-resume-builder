# Fly.io Configuration File
# Copy this to fly.toml and customize for your app

app = "ai-resume-builder"
primary_region = "iad"

[build]

[env]
  PORT = "8000"

[http_service]
  internal_port = 8000
  force_https = true
  auto_stop_machines = true
  auto_start_machines = true
  min_machines_running = 0
  processes = ["app"]

  [[http_service.checks]]
    grace_period = "10s"
    interval = "30s"
    method = "GET"
    timeout = "5s"
    path = "/"

# Web server process
[[vm]]
  cpu_kind = "shared"
  cpus = 1
  memory_mb = 256
  processes = ["app"]

# Celery worker process (runs in same app)
[[vm]]
  cpu_kind = "shared"
  cpus = 1
  memory_mb = 256
  processes = ["celery-worker"]

[[processes]]
  app = "celery-worker"
  command = "celery -A core worker -l info -P eventlet --concurrency=10"

# ============================================
# MEDIA FILES STORAGE
# ============================================
# Choose ONE option:

# Option 1: Fly Volumes (FREE - Recommended for starting)
# 1. Create volume: fly volumes create media_data --size 3 --region iad
# 2. Uncomment the mount below:
[[mounts]]
  source = "media_data"
  destination = "/app/media"

# Option 2: AWS S3 (PAID - Recommended for production)
# 1. Create S3 bucket and IAM user
# 2. Set environment variables:
#    fly secrets set USE_S3=True
#    fly secrets set AWS_ACCESS_KEY_ID="..."
#    fly secrets set AWS_SECRET_ACCESS_KEY="..."
#    fly secrets set AWS_STORAGE_BUCKET_NAME="..."
#    fly secrets set AWS_S3_REGION_NAME="us-east-1"
# 3. Keep the mount commented out (S3 is used automatically)

